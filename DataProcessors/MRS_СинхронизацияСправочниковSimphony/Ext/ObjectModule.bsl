// Обработка MRS_СинхронизацияСправочниковSimphony
// Назначение: Загрузка эталонных справочников из Simphony REST API
// Справочники: MRS_МажорнаяГруппа, MRS_СемейнаяГруппа, MRS_КлассМеню

#Область ПрограммныйИнтерфейс

// Синхронизирует мажорные группы из Simphony
//
// Возвращаемое значение:
//   Структура - результат синхронизации:
//     * Успех - Булево
//     * КоличествоЗагружено - Число
//     * ТекстОшибки - Строка
//
Функция СинхронизироватьМажорныеГруппы() Экспорт
	
	Возврат MRS_ИнтеграцияSimphonyСервер.ЗагрузитьМажорныеГруппы();
	
КонецФункции

// Синхронизирует семейные группы из Simphony
//
// Возвращаемое значение:
//   Структура - результат синхронизации (аналогично СинхронизироватьМажорныеГруппы)
//
Функция СинхронизироватьСемейныеГруппы() Экспорт
	
	Возврат MRS_ИнтеграцияSimphonyСервер.ЗагрузитьСемейныеГруппы();
	
КонецФункции

// Синхронизирует классы меню из Simphony
//
// Возвращаемое значение:
//   Структура - результат синхронизации (аналогично СинхронизироватьМажорныеГруппы)
//
Функция СинхронизироватьКлассыМеню() Экспорт
	
	Возврат MRS_ИнтеграцияSimphonyСервер.ЗагрузитьКлассыМеню();
	
КонецФункции

// Синхронизирует все справочники из Simphony
//
// Возвращаемое значение:
//   Структура - общий результат синхронизации:
//     * Успех - Булево - Истина, если все справочники загружены успешно
//     * МажорныеГруппы - Структура - результат загрузки мажорных групп
//     * СемейныеГруппы - Структура - результат загрузки семейных групп
//     * КлассыМеню - Структура - результат загрузки классов меню
//     * ТекстОшибки - Строка - сводный текст ошибок
//
Функция СинхронизироватьВсеСправочники() Экспорт
	
	Результат = Новый Структура;
	Результат.Вставить("Успех", Истина);
	Результат.Вставить("МажорныеГруппы", Неопределено);
	Результат.Вставить("СемейныеГруппы", Неопределено);
	Результат.Вставить("КлассыМеню", Неопределено);
	Результат.Вставить("ТекстОшибки", "");
	
	МассивОшибок = Новый Массив;
	
	// Загружаем мажорные группы
	РезультатМажорные = СинхронизироватьМажорныеГруппы();
	Результат.МажорныеГруппы = РезультатМажорные;
	
	Если НЕ РезультатМажорные.Успех Тогда
		
		Результат.Успех = Ложь;
		МассивОшибок.Добавить(СтрШаблон(
			"Мажорные группы: %1",
			РезультатМажорные.ТекстОшибки));
		
	КонецЕсли;
	
	// Загружаем семейные группы
	РезультатСемейные = СинхронизироватьСемейныеГруппы();
	Результат.СемейныеГруппы = РезультатСемейные;
	
	Если НЕ РезультатСемейные.Успех Тогда
		
		Результат.Успех = Ложь;
		МассивОшибок.Добавить(СтрШаблон(
			"Семейные группы: %1",
			РезультатСемейные.ТекстОшибки));
		
	КонецЕсли;
	
	// Загружаем классы меню
	РезультатКлассы = СинхронизироватьКлассыМеню();
	Результат.КлассыМеню = РезультатКлассы;
	
	Если НЕ РезультатКлассы.Успех Тогда
		
		Результат.Успех = Ложь;
		МассивОшибок.Добавить(СтрШаблон(
			"Классы меню: %1",
			РезультатКлассы.ТекстОшибки));
		
	КонецЕсли;
	
	// Формируем общий текст ошибки
	Если МассивОшибок.Количество() > 0 Тогда
		
		Результат.ТекстОшибки = СтрСоединить(МассивОшибок, Символы.ПС);
		
	КонецЕсли;
	
	Возврат Результат;
	
КонецФункции

#КонецОбласти

